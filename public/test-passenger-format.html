<!DOCTYPE html>
<html>
<head>
    <title>Test Passenger Parameter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Test Passenger Parameter Generation</h2>
        <button class="btn btn-primary" onclick="testPassengers()">Test Children + Infants</button>
        <div id="result" class="mt-3"></div>
    </div>

    <script>
        async function testPassengers() {
            const testParams = {
                tripType: 'roundtrip',
                departureAirport: 'Kingsford Smith International Airport',
                departureCity: 'Sydney, NSW, Australia', 
                departureCode: 'SYD',
                arrivalAirport: 'Ninoy Aquino International Airport',
                arrivalCity: 'Manila, Philippines',
                arrivalCode: 'MNL',
                departureDate: '2025-08-19',
                returnDate: '2025-08-26',
                adults: 2,
                children: 1,
                childrenAges: [16],
                infants: 1,
                infantAges: [0],
                infantInLap: true,
                cabinClass: 'economy'
            };

            try {
                const response = await fetch('/api/flights/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testParams)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Extract and decode the passengers parameter
                    const url = new URL(data.url);
                    const passengers = url.searchParams.get('passengers');
                    
                    document.getElementById('result').innerHTML = `
                        <div class="alert alert-success">
                            <h5>Test Results:</h5>
                            <p><strong>Expected:</strong> <code>children:2[16;0],adults:2,infantinlap:Y</code></p>
                            <p><strong>Generated:</strong> <code>${passengers}</code></p>
                            <hr>
                            <h6>Full URL:</h6>
                            <div style="word-break: break-all; font-family: monospace; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                                ${decodeURIComponent(data.url)}
                            </div>
                            <button class="btn btn-sm btn-primary mt-2" onclick="window.open('${data.url}', '_blank')">Test URL</button>
                        </div>
                    `;
                } else {
                    document.getElementById('result').innerHTML = `<div class="alert alert-danger">Error: ${data.error}</div>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
